(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{"013z":function(e,t,a){"use strict";var r=a("q1tI"),n=a.n(r),o=a("NmYn"),i=a.n(o),s=a("Wbzz"),p=a("Xrax"),l=a("k4MR"),b=a("TSYQ"),c=a.n(b),m=a("QH2O"),u=a("qKvR"),d=function(e){var t,a=e.title,r=e.tabs,n=void 0===r?[]:r;return Object(u.b)("div",{className:c()(m.pageHeader,(t={},t[m.withTabs]=n.length,t))},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12"},Object(u.b)("h1",{id:"page-title",className:m.text},a)))))},h=a("BAC9"),g=function(e){var t=e.relativePagePath,a=e.repository,r=Object(s.useStaticQuery)("1364590287").site.siteMetadata.repository,n=a||r,o=n.baseUrl,i=n.subDirectory,p=o+"/edit/"+n.branch+i+"/src/pages"+t;return o?Object(u.b)("div",{className:"bx--row "+h.row},Object(u.b)("div",{className:"bx--col"},Object(u.b)("a",{className:h.link,href:p},"Edit this page on GitHub"))):null},O=a("FCXl"),T=a("dI71"),j=a("I8xM"),P=function(e){function t(){return e.apply(this,arguments)||this}return Object(T.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.tabs,a=e.slug,r=a.split("/").filter(Boolean).slice(-1)[0],n=t.map((function(e){var t,n=i()(e,{lower:!0,strict:!0}),o=n===r,p=new RegExp(r+"/?(#.*)?$"),l=a.replace(p,n);return Object(u.b)("li",{key:e,className:c()((t={},t[j.selectedItem]=o,t),j.listItem)},Object(u.b)(s.Link,{className:j.link,to:""+l},e))}));return Object(u.b)("div",{className:j.tabsContainer},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(u.b)("nav",null,Object(u.b)("ul",{className:j.list},n))))))},t}(n.a.Component),f=a("MjG9");t.a=function(e){var t=e.pageContext,a=e.children,r=e.location,n=e.Title,o=t.frontmatter,b=void 0===o?{}:o,c=t.relativePagePath,m=t.titleType,h=b.tabs,T=b.title,j=b.theme,N=b.description,v=b.keywords,R=Object(s.useStaticQuery)("2456312558").site.pathPrefix,M=R?r.pathname.replace(R,""):r.pathname,I=h?M.split("/").filter(Boolean).slice(-1)[0]||i()(h[0],{lower:!0}):"";return Object(u.b)(l.a,{tabs:h,homepage:!1,theme:j,pageTitle:T,pageDescription:N,pageKeywords:v,titleType:m},Object(u.b)(d,{title:n?Object(u.b)(n,null):T,label:"label",tabs:h}),h&&Object(u.b)(P,{slug:M,tabs:h,currentTab:I}),Object(u.b)(f.a,{padded:!0},a,Object(u.b)(g,{relativePagePath:c})),Object(u.b)(O.a,{pageContext:t,location:r,slug:M,tabs:h,currentTab:I}),Object(u.b)(p.a,null))}},BAC9:function(e,t,a){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,a){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},QH2O:function(e,t,a){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}},u6bY:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return s})),a.d(t,"default",(function(){return b}));var r=a("wx14"),n=a("zLVn"),o=(a("q1tI"),a("7ljp")),i=a("013z"),s=(a("qKvR"),{}),p={_frontmatter:s},l=i.a;function b(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(o.b)(l,Object(r.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",null,"Alert Manager to SNMP"),Object(o.b)("p",null,"Prometheus Alertmanager natively supports a couple of different event destinations like Slack, email, PagerDuty, HipChat and ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://prometheus.io/docs/alerting/configuration/"}),"others"),". For notification mechanisms not natively supported by the Alertmanager, the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://prometheus.io/docs/alerting/configuration/#webhook_config"}),"webhook receiver")," allows for integration."),Object(o.b)("p",null,"SNMP traps are still a popular method of sending events informing about issues that needs to be reported.\nThe instructions below allows to quickly setup a simple integration mechanism which will allow to generate SNMP traps for selected Prometheus alerts using open source ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/chrusty/prometheus_webhook_snmptrapper"}),"Prometheus WebHook to SNMP-trap forwarder"),"."),Object(o.b)("p",null,"1). Copy ",Object(o.b)("inlineCode",{parentName:"p"},"prometheus_webhook_snmptrapper")," to a Linux server accessible from your Prometheus AlertManager instance (lets name it ",Object(o.b)("inlineCode",{parentName:"p"},"linux1"),"). It is a single binary file which can be compiled from Golang ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/chrusty/prometheus_webhook_snmptrapper"}),"sources")," available on GitHub. You can also download the compiled Linux 64-bit version from ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://ibm.box.com/s/sn45d6n2mviwwi3iusmzpxa8fzd75l2p"}),"here"),"."),Object(o.b)("p",null,"2). Install ",Object(o.b)("inlineCode",{parentName:"p"},"net-snmp")," and ",Object(o.b)("inlineCode",{parentName:"p"},"snmptrapd")," packages. On Ubuntu run:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"sudo apt-get install net-snmp snmptrapd\n")),Object(o.b)("p",null,"3). In the AlertManager configuration file, define the webhook receiver address in section ",Object(o.b)("inlineCode",{parentName:"p"},"receivers"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"    receivers:\n      - name: prometheus_webhook_snmptrapper\n        webhook_configs:\n        - url: 'http://<linux1_ip>:9999'\n")),Object(o.b)("p",null,"Port ",Object(o.b)("inlineCode",{parentName:"p"},"9999")," is port of ",Object(o.b)("inlineCode",{parentName:"p"},"prometheus_webhook_snmptrapper")," webhook server (make sure if it not already taken by other process) and can be changed using input parameter of ",Object(o.b)("inlineCode",{parentName:"p"},"prometheus_webhook_snmptrapper"),". "),Object(o.b)("p",null,"Edit Alertmanager secret in order to configure grouping and notification receiver."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"oc -n openshift-monitoring get secret alertmanager-main --template='{{ index .data \"alertmanager.yaml\" }}' |base64 -d > alertmanager.yaml\n")),Object(o.b)("p",null,"Then edit the ",Object(o.b)("inlineCode",{parentName:"p"},"alertmanager.yaml"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"global:\n  resolve_timeout: 5m\nroute:\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 12h\n  receiver: default\n  routes:\n  - match:\n      service: example-app\n    routes:\n    - match:\n        severity: critical\n      receiver: prometheus_webhook_snmptrapper\nreceivers:\n  - name: prometheus_webhook_snmptrapper\n    webhook_configs:\n    - url: 'http://<linux1_ip>:9999'\n")),Object(o.b)("p",null,"With this configuration, alerts of critical severity fired by the ",Object(o.b)("inlineCode",{parentName:"p"},"example-app")," service are sent using the ",Object(o.b)("inlineCode",{parentName:"p"},"prometheus_webhook_snmptrapper")," receiver, which means that these alerts are paged to a chosen person."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"$ oc -n openshift-monitoring create secret generic alertmanager-main --from-file=alertmanager.yaml --dry-run -o=yaml |  oc -n openshift-monitoring replace secret --filename=-\n")),Object(o.b)("p",null,"4). Copy the following MIB files: ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://raw.githubusercontent.com/chrusty/prometheus_webhook_snmptrapper/master/PROMETHEUS-TRAPPER-MIB.txt"}),"PROMETHEUS-TRAPPER-MIB.txt")," and ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://raw.githubusercontent.com/hardaker/net-snmp/master/mibs/SNMPv2-SMI.txt"}),"SNMPv2-SNI")," to your MIB directory ex. ",Object(o.b)("inlineCode",{parentName:"p"},"/usr/share/snmp/mibs"),". You can find you MIBDIR using the following command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"snmptranslate -Dinit_mib .1.3 2>&1 |grep MIBDIR\n")),Object(o.b)("p",null,"5). Start ",Object(o.b)("inlineCode",{parentName:"p"},"snmptrapd")," using:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"snmptrapd -n -Ls d -m PROMETHEUS-TRAPPER-MIB\n")),Object(o.b)("p",null,"It will start snmptrapd as a daemon and SNMP traps will be logged to local syslog file (",Object(o.b)("inlineCode",{parentName:"p"},"/var/log/syslog")," by default on Ubuntu)."),Object(o.b)("p",null,"6). Start ",Object(o.b)("inlineCode",{parentName:"p"},"prometheus_webhook_snmptrapper")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"./prometheus_webhook_snmptrapper --webhookaddress 0.0.0.0:9999 > prom_snmp.log 2>&1  &\n")),Object(o.b)("p",null,"7). Verify that some Prometheus alerts has been generated after you started ",Object(o.b)("inlineCode",{parentName:"p"},"prometheus_webhook_snmptrapper")," and check the contents of syslog and ",Object(o.b)("inlineCode",{parentName:"p"},"prom_snmp.log"),"."),Object(o.b)("p",null,"The contents of ",Object(o.b)("inlineCode",{parentName:"p"},"prom_snmp.log")," should be similar to the one below:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'time="2018-07-05T09:47:53-05:00" level=info msg="Preparing the alerts channel" logger=main\ntime="2018-07-05T09:47:53-05:00" level=info msg="Starting the SNMP trapper" address="127.0.0.1:162" logger=SNMP-trapper\ntime="2018-07-05T09:47:53-05:00" level=info msg="Starting the Webhook server" address="0.0.0.0:9999" logger=Webhook-server\ntime="2018-07-05T09:51:05-05:00" level=debug msg="Received a valid webhook alert" logger=Webhook-server payload="{\\"receiver\\":\\"default-receiver\\",\\"status\\":\\"firing\\",\\"alerts\\":[{\\"status\\":\\"firing\\",\\"labels\\":{\\"alertname\\":\\"ICPMonitoringHeartbeat\\",\\"severity\\":\\"none\\"},\\"annotations\\":{\\"description\\":\\"This is a Hearbeat event meant to ensure that the entire Alerting pipeline is functional.\\",\\"summary\\":\\"Alerting Heartbeat\\"},\\"startsAt\\":\\"2018-06-26T11:49:29.035689542Z\\",\\"endsAt\\":\\"0001-01-01T00:00:00Z\\",\\"generatorURL\\":\\"http://monitoring-prometheus-77d664c568-jzqnp:9090/graph?g0.expr=vector%281%29\\\\u0026g0.tab=1\\"}],\\"groupLabels\\":{\\"alertname\\":\\"ICPMonitoringHeartbeat\\"},\\"commonLabels\\":{\\"alertname\\":\\"ICPMonitoringHeartbeat\\",\\"severity\\":\\"none\\"},\\"commonAnnotations\\":{\\"description\\":\\"This is a Hearbeat event meant to ensure that the entire Alerting pipeline is functional.\\",\\"summary\\":\\"Alerting Heartbeat\\"},\\"externalURL\\":\\"http://monitoring-prometheus-alertmanager-7fdbf6c5cd-xdlhh:9093\\",\\"version\\":\\"4\\",\\"groupKey\\":\\"{}/{alertname=\\\\\\"ICPMonitoringHeartbeat\\\\\\"}:{alertname=\\\\\\"ICPMonitoringHeartbeat\\\\\\"}\\"}\\n"\ntime="2018-07-05T09:51:05-05:00" level=debug msg="Forwarding an alert to the SNMP trapper" index=0 labels="map[alertname:ICPMonitoringHeartbeat severity:none]" logger=Webhook-server status=firing\ntime="2018-07-05T09:51:05-05:00" level=debug msg="Received an alert" logger=SNMP-trapper status=firing\ntime="2018-07-05T09:51:05-05:00" level=debug msg="Created snmpgo.SNMP object" address="127.0.0.1:162" community=public logger=SNMP-trapper retries=1\ntime="2018-07-05T09:51:05-05:00" level=info msg="It\'s a trap!" logger=SNMP-trapper status=firing\n')),Object(o.b)("p",null,"Example Prometheus SNMP traps logged to syslog:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"Aug  6 07:55:20 csmo-icp2103-rs snmptrapd[7453]: 2018-08-06 07:55:20 UDP: [127.0.0.1]:55091->[127.0.0.1]:162 [UDP: [127.0.0.1]:55091->[127.0.0.1]:162]:#012SNMPv2-SMI::snmpModules.1.1.4.1.0 = OID: PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperFiringNotification#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationTimestamp = STRING: 2018-08-06T12:14:09Z#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationDescription = STRING: 99th percentile Latency for LIST requests to the kube-apiserver is higher than 1s.#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationInstance = STRING: #011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationSeverity = STRING: warning#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationLocation = STRING: #011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationService = STRING: #011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationJob = STRING: kubernetes-apiservers\nAug  6 07:57:30 csmo-icp2103-rs snmptrapd[7453]: 2018-08-06 07:57:30 UDP: [127.0.0.1]:39868->[127.0.0.1]:162 [UDP: [127.0.0.1]:39868->[127.0.0.1]:162]:#012SNMPv2-SMI::snmpModules.1.1.4.1.0 = OID: PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperFiringNotification#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationTimestamp = STRING: 2018-08-06T12:00:29Z#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationDescription = STRING: This is a Hearbeat event meant to ensure that the entire Alerting pipeline is functional.#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationInstance = STRING: #011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationSeverity = STRING: none#011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationLocation = STRING: #011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationService = STRING: #011PROMETHEUS-TRAPPER-MIB-1::prometheusTrapperNotificationJob = STRING:\n")))}b.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-day-2-event-management-snmp-trap-index-mdx-2e43ce636ae51ac903c4.js.map